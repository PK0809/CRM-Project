{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Client List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        function toggleMenu(id) {
            document.getElementById(id).classList.toggle('hidden');
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('hidden');
        }

        function openClientForm() {
            document.getElementById('clientFormModal').classList.remove('hidden');
        }

        function closeClientForm() {
            document.getElementById('clientFormModal').classList.add('hidden');
        }

        window.onclick = function (event) {
            const modal = document.getElementById('clientFormModal');
            if (event.target === modal) {
                closeClientForm();
            }
        }
    </script>
    <style>
        .add-btn {
            float: right;
            margin-bottom: 20px;
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }

            .add-btn:hover {
                background-color: #45a049;
            }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Header -->
    <header class="flex items-center justify-between bg-white shadow p-4 h-[100px]">
        <div class="flex items-center space-x-4 w-[500px]">
            <button onclick="toggleSidebar()" class="text-gray-500 hover:text-black focus:outline-none text-xl">☰</button>
            <a href="{% url 'dashboard' %}">
                <img src="{% static 'images/logo.png' %}" alt="Logo" class="w-[200px] h-auto ml-[-12px]">
            </a>
        </div>
        <div class="flex items-center space-x-2">
            <span class="text-gray-700 font-semibold">Welcome, User</span>
            <a href="{% url 'profile' %}" class="text-blue-600 hover:underline">Profile</a>
            <a href="{% url 'logout' %}" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Logout</a>
        </div>
    </header>

    <div class="flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-[250px] bg-white border-r border-gray-200 p-4">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Main Menu</h2>

            <!-- Admin Section -->
            {% if request.user.is_superuser %}
            <div class="mb-4">
                <button onclick="toggleMenu('adminMenu')" class="w-full text-left py-2 px-4 bg-gray-100 hover:bg-gray-200 rounded font-bold">
                    Admin
                </button>
                <div id="adminMenu" class="ml-4 mt-2 hidden">
                    <li><a href="{% url 'user_list' %}">👤 Users</a></li>
                </div>
            </div>
            {% endif %}

            <div class="mt-4">
                <button onclick="toggleMenu('salesMenu')" class="w-full text-left py-2 px-4 bg-blue-100 hover:bg-blue-200 rounded font-bold">Sales</button>
                <div id="salesMenu" class="ml-4 mt-2 hidden">
                    {% if perms.crm.view_client %}
                    <a href="/client/" class="block py-1 text-blue-600 hover:underline font-semibold">🧾 Client</a>
                    {% endif %}

                    {% if perms.crm.view_lead %}
                    <a href="/lead/" class="block py-1 text-blue-600 hover:underline font-semibold">📋 Lead</a>
                    {% endif %}

                    {% if perms.crm.view_estimation %}
                    <a href="/estimation/" class="block py-1 text-blue-600 hover:underline font-semibold">📐 Estimation</a>
                    {% endif %}

                    {% if perms.crm.view_invoice %}
                    <a href="/invoices/" class="block py-1 text-blue-600 hover:underline font-semibold">🧾 Invoice</a>
                    {% endif %}

                    {% if perms.crm.view_report %}
                    <a href="{% url 'report_list' %}" class="block py-1 text-blue-600 hover:underline font-semibold">📊 Reports</a>
                    {% endif %}
                </div>
            </div>

            <!-- Purchase Section -->
            {% if request.user.is_superuser %}
            <div class="mt-4">
                <button onclick="toggleMenu('purchaseMenu')" class="w-full text-left py-2 px-4 bg-green-100 hover:bg-green-200 rounded font-bold">Purchase</button>
                <div id="purchaseMenu" class="ml-4 mt-2 hidden">
                    <a href="{% url 'vendor' %}" class="block py-1 text-green-600 hover:underline font-bold">Vendor</a>
                    <a href="#" class="block py-1 text-green-600 hover:underline font-bold">PO</a>
                    <a href="#" class="block py-1 text-green-600 hover:underline font-bold">Bill</a>
                </div>
            </div>
            {% endif %}
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Clients</h1>

            <div class="flex items-center justify-between mb-4">

                <!-- Search Bar -->
                <input type="text"
                       id="clientSearch"
                       placeholder="🔍 Search anything..."
                       class="border border-gray-300 rounded px-3 py-2 w-64 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4"
                       onkeyup="filterClientsTable()" />


                <!-- Add Button (existing) -->
                <button onclick="openClientForm()" class="add-btn ml-auto">➕ Add New Client</button>
            </div>

            <!-- Client Table -->
            <table border="1" cellpadding="10" class="mt-4 bg-white w-full border border-gray-300">
                <thead class="bg-gray-100 font-bold">
                    <tr>
                        <th class="text-left p-2">Company Name</th>
                        <th class="text-left p-2">Type of Company</th>
                        <th class="text-left p-2">GST No</th>
                        <th class="text-left p-2">Actions</th>
                    </tr>
                </thead>
                <tbody id="clientTableBody">
                    {% for client in clients %}
                    <tr class="border-t border-gray-200">
                        <td class="p-2">{{ client.company_name }}</td>
                        <td class="p-2">{{ client.type_of_company }}</td>
                        <td class="p-2">{{ client.gst_no }}</td>
                        <td class="p-2">
                            <a href="{% url 'edit_client' client.id %}" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-yellow-600 shadow text-sm font-medium">
                                ✏️ Edit
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </main>
    </div>
    <div class="mt-0.5 flex justify-center space-x-2">
        {% if page_obj.has_previous %}
        <a href="?q={{ query }}&page={{ page_obj.previous_page_number }}" class="px-1 py-1 bg-gray-200 rounded hover:bg-gray-300">&laquo;</a>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
        <span class="px-3 py-1 bg-blue-500 text-white rounded">{{ num }}</span>
        {% else %}
        <a href="?q={{ query }}&page={{ num }}" class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300">{{ num }}</a>
        {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
        <a href="?q={{ query }}&page={{ page_obj.next_page_number }}" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">&raquo;</a>
        {% endif %}
    </div>

    <!-- Footer -->
    <footer class="bg-white text-right text-gray-600 p-4 shadow">
        Designed & Developed By Nagaraj Nada
    </footer>

    <!-- Modal Form -->
    <div id="clientFormModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-lg shadow-lg w-[400px]">
            <h2 class="text-xl font-bold mb-4">Add New Client</h2>
            <form method="POST" action="{% url 'client_entry' %}">
                {% csrf_token %}
                <div class="mb-3">
                    <label class="block font-semibold">Company Name *</label>
                    <input type="text" name="company_name" required class="w-full border p-2 rounded">
                </div>
                <div class="mb-3">
                    <label class="block font-semibold">Type of Company *</label>
                    <select name="type_of_company" required class="w-full border p-2 rounded">
                        <option value="">-- Select Type --</option>
                        <option value="Private Limited">Private Limited</option>
                        <option value="Public Limited">Public Limited</option>
                        <option value="Partnership">Partnership</option>
                        <option value="Proprietorship">Proprietorship</option>
                        <option value="LLP">LLP</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="block font-semibold">GST No</label>
                    <input type="text" name="gst_no" class="w-full border p-2 rounded">
                </div>
                <div class="flex justify-end space-x-2 mt-4">
                    <button type="button" onclick="closeClientForm()" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>
    <script>
        function filterClientsTable() {
            const input = document.getElementById("clientSearch");
            const filter = input.value.toLowerCase();
            const rows = document.querySelectorAll("#clientTableBody tr");

            rows.forEach(row => {
                const cells = row.querySelectorAll("td");
                let matchFound = false;

                cells.forEach(cell => {
                    if (cell.textContent.toLowerCase().includes(filter)) {
                        matchFound = true;
                    }
                });

                row.style.display = matchFound ? "" : "none";
            });
        }
    </script>

</body>
</html>
