{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .hidden {
            display: none;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen text-sm text-gray-900">
    <!-- Header -->
    <header class="flex items-center justify-between bg-white shadow p-4 h-[100px]">
        <div class="flex items-center space-x-4 w-[500px]">
            <button onclick="toggleSidebar()" class="text-xl text-gray-600 hover:text-black">☰</button>
            <a href="{% url 'dashboard' %}">
                <img src="{% static 'images/logo.png' %}" alt="Logo" class="w-[200px] ml-[-12px]">
            </a>
        </div>
        <div class="flex items-center space-x-4">
            <span class="text-gray-700 font-semibold">Welcome, {{ request.user.username }}</span>
            <a href="{% url 'profile' %}" class="text-blue-600 hover:underline">Profile</a>
            <a href="{% url 'logout' %}" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Logout</a>
        </div>
    </header>

    <div class="flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-[250px] bg-white border-r border-gray-200 p-4">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Main Menu</h2>

            <!-- Admin Section -->
            <div class="mb-4">
                <button onclick="toggleMenu('adminMenu')" class="w-full text-left py-2 px-4 bg-gray-100 hover:bg-gray-200 rounded font-bold">Admin</button>
                <div id="adminMenu" class="ml-4 mt-2 hidden">
                    <a href="{% url 'user_list' %}" class="block py-1 hover:underline">👤 Users</a>
                </div>
            </div>

            <!-- Sales Section -->
            <div class="mt-4">
                <button onclick="toggleMenu('salesMenu')" class="w-full text-left py-2 px-4 bg-blue-100 hover:bg-blue-200 rounded font-bold">Sales</button>
                <div id="salesMenu" class="ml-4 mt-2 hidden">
                    {% if perms.crm.view_client %}
                    <a href="/client/" class="block py-1 text-blue-600 hover:underline font-semibold">🧾 Client</a>
                    {% endif %}
                    {% if perms.crm.view_lead %}
                    <a href="/lead/" class="block py-1 text-blue-600 hover:underline font-semibold">📋 Lead</a>
                    {% endif %}
                    {% if perms.crm.view_estimation %}
                    <a href="/estimation/" class="block py-1 text-blue-600 hover:underline font-semibold">📐 Estimation</a>
                    {% endif %}
                    {% if perms.crm.view_invoice %}
                    <a href="/invoices/" class="block py-1 text-blue-600 hover:underline font-semibold">🧾 Invoice</a>
                    {% endif %}
                    {% if perms.crm.view_report %}
                    <a href="{% url 'report_list' %}" class="block py-1 text-blue-600 hover:underline font-semibold">📊 Reports</a>
                    {% endif %}
                </div>
            </div>

            <!-- Purchase Section -->
            <div class="mt-4">
                <button onclick="toggleMenu('purchaseMenu')" class="w-full text-left py-2 px-4 bg-green-100 hover:bg-green-200 rounded font-bold">Purchase</button>
                <div id="purchaseMenu" class="ml-4 mt-2 hidden">
                    <a href="{% url 'vendor' %}" class="block py-1 text-green-600 hover:underline font-bold">Vendor</a>
                    <a href="#" class="block py-1 text-green-600 hover:underline font-bold">PO</a>
                    <a href="#" class="block py-1 text-green-600 hover:underline font-bold">Bill</a>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6">
            <!-- Top Bar -->
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold text-gray-800">Users</h2>
                <a href="{% url 'user_create' %}" class="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium py-2 px-4 rounded-lg shadow">
                    ➕ Add New User
                </a>
            </div>

            <!-- User Table -->
            <table class="min-w-full bg-white border rounded shadow">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="py-2 px-4 border-b">Name</th>
                        <th class="py-2 px-4 border-b">Email</th>
                        <th class="py-2 px-4 border-b">Mobile</th>
                        <th class="py-2 px-4 border-b text-center">Admin</th>
                        <th class="py-2 px-4 border-b text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for profile in users %}
                    <tr class="hover:bg-gray-100">
                        <td class="py-2 px-4 border-b">
                            {% if profile.user.get_full_name %}
                            {{ profile.user.get_full_name }}
                            {% else %}
                            {{ profile.user.username }}
                            {% endif %}
                        </td>
                        <td class="py-2 px-4 border-b">{{ profile.user.email }}</td>
                        <td class="py-2 px-4 border-b">{{ profile.phone_number|default:"-" }}</td>
                        <td class="py-2 px-4 border-b text-center">{% if profile.user.is_superuser %}Yes{% else %}No{% endif %}</td>
                        <td class="py-2 px-4 border-b text-center space-x-2">
                            <a href="{% url 'edit_user' profile.user.id %}" class="text-blue-600 hover:underline">✏️</a>
                            <a href="{% url 'user_delete' profile.id %}" class="text-red-600 hover:underline" onclick="return confirm('Are you sure you want to delete this user?');">❌</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-4">No users found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </main>
    </div>

    <!-- Scripts -->
    <script>
        function toggleMenu(id) {
            document.getElementById(id).classList.toggle('hidden');
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('hidden');
        }
        th: nth - child(4), td: nth - child(4) {
            text - align: center;
            width: 80px;
        }
    </script>
</body>
</html>
